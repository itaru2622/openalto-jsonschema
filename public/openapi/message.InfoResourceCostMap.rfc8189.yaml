allOf:
  - allOf:
      - type: object
        properties:
          meta:
            type: object
            additionalProperties: true
        additionalProperties: true
      - properties:
          meta:
            allOf:
              - allOf:
                  - type: object
                    additionalProperties: true
                  - properties:
                      vtag:
                        type: object
                        properties:
                          resource-id:
                            type: string
                            pattern: ^[0-9a-zA-Z-:@_.]{1,64}$
                          tag:
                            type: string
                            pattern: ^[!-~]+$
                        required:
                          - resource-id
                          - tag
                      dependent-vtags:
                        type: array
                        items:
                          type: object
                          properties:
                            resource-id:
                              type: string
                              pattern: ^[0-9a-zA-Z-:@_.]{1,64}$
                            tag:
                              type: string
                              pattern: ^[!-~]+$
                          required:
                            - resource-id
                            - tag
              - properties:
                  dependent-vtags:
                    minItems: 1
                    maxItems: 1
                  multi-cost-types:
                    type: array
                    items:
                      type: object
                      properties:
                        cost-mode:
                          type: string
                          enum:
                            - numerical
                            - ordinal
                        cost-metric:
                          anyOf:
                            - type: string
                              pattern: ^[0-9a-zA-Z-:_.]{1,32}$
                            - enum:
                                - routingcost
                                - delay-ow
                                - delay-rt
                                - delay-variation
                                - hopcount
                                - lossrate
                                - tput
                                - bw-residual
                                - bw-maxres
                      required:
                        - cost-mode
                        - cost-metric
                    minItems: 1
                required:
                  - dependent-vtags
                  - multi-cost-types
          cost-map:
            type: object
            additionalProperties: false
            x-patternProperties:
              ^[0-9a-zA-Z-:@_.]{1,64}$:
                type: object
                patternProperties:
                  ^[0-9a-zA-Z-:@_.]{1,64}$:
                    anyOf:
                      - type: string
                      - type: number
                      - type: array
                      - type: boolean
                      - type: 'null'
                      - type: object
                        additionalProperties: true
                additionalProperties: false
        required:
          - meta
          - cost-map
